import{_ as ae}from"./rSdoIAfe.js";import{_ as R,p as M,b as G,g as ne,u as oe,f as se}from"./Dv1q3syl.js";import{u as K}from"./BPyS3Dol.js";import{E as L,r as w,T as Q,q as s,s as n,z as y,H as j,I as _,y as o,B as N,x as e,A as v,J as $,a3 as J,F as z,C as W,D as re,G as X,w as Y,K as ie,$ as ue}from"#entry";import{l as Z}from"./DnCtf8DX.js";import"./BJ2ClxiI.js";const de={class:"item"},me={class:"child"},pe={class:"author"},ve={key:0},ye={key:0},fe={key:0},ce={id:"main"},_e={key:1},ge={key:1},ke={id:"main2"},he={key:2,class:"child"},ee={__name:"Allreplylist",props:{parentmsg:{type:Object}},setup(d){let{message:m}=L(["message"]);const f=K("user"),h=w(!1),c=w(!1),r=w(),b=w(),C=async(a,t)=>{let u=await upImage(a,t);b.value.$img2Url(a,u)},V=a=>{c.value=!0,a.children==0&&(a.child=[])},A=async(a,t,u)=>{c.value=!1;let O=f.value.wif,x=f.value.username,i=G(),I="",F=r.value,T={tags:["cn","cn-reader","miao"],dapp:"miao",format:"markdown"};if(F==""){m.error("文本不能为空！",{duration:5e3});return}let p={parent_author:a,parent_permlink:t,title:I,author:x,permlink:i,body:F,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(T)};u.child.push(p);let l={wif:O,parentAuthor:a,parentPermlink:t,author:x,permlink:i,title:I,body:F,jsonMetadata:T};const{data:k,pending:U,error:S}=await M("/hiveapi/posttohive",l);S.value?m.error(`回复失败！
`+S.value,{duration:5e3}):m.success("回复成功",{duration:5e3}),r.value=""},D=a=>{h.value=!0,r.value=a.body},g=async a=>{h.value=!1,a.body=r.value;let t=f.value.wif,u=f.value.username,O=a.parent_author,x=a.parent_permlink,i=a.permlink,I=a.title,F=r.value,H=a.json_metadata,T={wif:t,parentAuthor:O,parentPermlink:x,author:u,permlink:i,title:I,body:F,jsonMetadata:H};const{data:p,pending:l,error:k}=await M("/hiveapi/posttohive",T);k.value?m.error(`更新失败！
`+k.value,{duration:5e3}):m.success("更新成功",{duration:5e3}),r.value=""},q=()=>{c.value=!1,h.value=!1,r.value=""};return(a,t)=>{const u=Q("mavon-editor"),O=R,x=ee;return n(),s("div",de,[y("span",me,[y("span",pe,"@"+N(d.parentmsg.author),1),t[7]||(t[7]=_(" 　 ",-1)),o(u,{class:"replymd",modelValue:d.parentmsg.body,"onUpdate:modelValue":t[0]||(t[0]=i=>d.parentmsg.body=i),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"])]),e(f)?(n(),s("div",ve,[d.parentmsg.author==e(f).username?(n(),s("div",ye,[o(e($),{quaternary:"",onClick:t[1]||(t[1]=i=>D(d.parentmsg))},{default:v(()=>[...t[8]||(t[8]=[_("编辑",-1)])]),_:1}),e(h)?(n(),s("div",fe,[o(O,null,{default:v(()=>[y("div",ce,[o(u,{modelValue:e(r),"onUpdate:modelValue":t[2]||(t[2]=i=>J(r)?r.value=i:null),ref_key:"md",ref:b,"m-y-3":"",onImgAdd:C},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:t[3]||(t[3]=i=>g(d.parentmsg))},{default:v(()=>[...t[9]||(t[9]=[_("更新",-1)])]),_:1}),o(e($),{quaternary:"",onClick:q},{default:v(()=>[...t[10]||(t[10]=[_("取消",-1)])]),_:1})])):j("",!0)])):(n(),s("div",_e,[o(e($),{quaternary:"",onClick:t[4]||(t[4]=i=>V(d.parentmsg))},{default:v(()=>[...t[11]||(t[11]=[_("回复",-1)])]),_:1})]))])):j("",!0),e(c)?(n(),s("div",ge,[o(O,null,{default:v(()=>[y("div",ke,[o(u,{modelValue:e(r),"onUpdate:modelValue":t[5]||(t[5]=i=>J(r)?r.value=i:null),ref_key:"md",ref:b,"m-y-3":"",onImgAdd:C},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:t[6]||(t[6]=i=>A(d.parentmsg.author,d.parentmsg.permlink,d.parentmsg))},{default:v(()=>[...t[12]||(t[12]=[_("提交",-1)])]),_:1}),o(e($),{quaternary:"",onClick:q},{default:v(()=>[...t[13]||(t[13]=[_("取消",-1)])]),_:1})])):j("",!0),d.parentmsg.child?(n(),s("ul",he,[(n(!0),s(z,null,W(d.parentmsg.child,(i,I)=>(n(),re(x,{parentmsg:i,key:I},null,8,["parentmsg"]))),128))])):j("",!0)])}}},be={key:0},we=["src"],$e={key:1,class:"reply"},Ce={__name:"Allreplies",props:{otherreply:{type:Object,default:{}}},async setup(d){let m,f;const h=d,c=X(),r=c.params.author,b=c.params.permlink;let C={author:r,permlink:b};const{data:V,pending:A}=([m,f]=Y(()=>M("/hiveapi/getallreplies",C)),m=await m,f(),m);return ie(h,()=>{V.value.result.push(h.otherreply)}),(D,g)=>{const q=ee;return n(),s(z,null,[g[0]||(g[0]=y("h3",null,"留言",-1)),e(A)?(n(),s("div",be,[y("img",{src:e(Z),alt:"miao loading"},null,8,we)])):(n(),s("div",$e,[(n(!0),s(z,null,W(e(V).result,a=>(n(),s("div",null,[o(q,{parentmsg:a},null,8,["parentmsg"])]))),256))]))],64)}}},Ve={subContainer:""},xe={key:0},je={key:1},Ae={key:2},Oe={"text-size-2xl":"","text-center":"","m-t-10":""},Ie={"text-center":""},Se={key:0,"text-center":""},qe=["src"],Fe={key:1,flex:""},Te={key:0,"m-t-4":"","m-b-3":"","m-r-4":""},Ue={"m-t-4":"","m-b-3":""},Be={key:2},Ne={key:3},Ge={__name:"[permlink]",async setup(d){let m,f,{message:h}=L(["message"]);const c=K("user"),r=X(),b=r.params.author,C=r.params.permlink;let V=w(!0);const A=w(!1),D=w(),g=w(),q=w(),a=w(),t=p=>{let l=/https:\/\/ipfs\.ilark\.io/g;return l!=null?p.replace(l,"https://yoyo.ilark.io/0x0/https://ipfs.ilark.io"):p},{data:u,pending:O,error:x}=([m,f]=Y(()=>ne("/hiveapi/miaos/@"+b+"/"+C)),m=await m,f(),m);u.value&&(V.value=!1,a.value=t(u.value.result.body)),oe({title:u?.value?.result.title});const i=()=>{ue({path:"/edit/"+C})},I=()=>{A.value=!0},F=async(p,l)=>{let k=await upImage(p,l);D.value.$img2Url(p,k)},H=async()=>{A.value=!1;let p=c.value.username,l=c.value.wif,k="",U=g.value,S=G(),B={tags:["cn","miao"],dapp:"miao",format:"markdown"},te={wif:l,parentAuthor:b,parentPermlink:C,author:p,permlink:S,title:k,body:U,jsonMetadata:B};const{data:De,pending:He,error:P}=await M("/hiveapi/posttohive",te);P.value?h.error(`回复失败！
`+P.value,{duration:5e3}):h.success("回复成功",{duration:5e3});let le={parent_author:b,parent_permlink:C,title:k,author:p,permlink:S,body:U,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(B)};q.value=le,g.value=""},T=()=>{A.value=!1,g.value=""};return(p,l)=>{const k=ae,U=Q("mavon-editor"),S=R,E=Ce;return n(),s("div",Ve,[e(O)||e(V)?(n(),s("div",xe,[o(k)])):e(x)?(n(),s("div",je," 错误 "+N(e(x)),1)):(n(),s("div",Ae,[o(S,null,{default:v(()=>[y("div",Oe,N(e(u).result.title),1),y("p",Ie,"@"+N(e(u).result.author)+" 　"+N(("formatTime"in p?p.formatTime:e(se))(e(u).result.created)),1),o(U,{"p-t-3":"",modelValue:e(a),"onUpdate:modelValue":l[0]||(l[0]=B=>J(a)?a.value=B:null),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"]),l[2]||(l[2]=y("br",null,null,-1)),_(" 标签（tags）: "+N(e(u).result.tags.join("　")),1)]),_:1}),l[7]||(l[7]=y("br",null,null,-1)),e(V)?(n(),s("div",Se,[y("img",{src:e(Z),alt:"miao loading"},null,8,qe)])):j("",!0),e(c)?(n(),s("div",Fe,[e(c).username==e(b)?(n(),s("div",Te,[o(e($),{"w-15":"",onClick:i},{default:v(()=>[...l[3]||(l[3]=[_("编辑",-1)])]),_:1})])):j("",!0),y("div",Ue,[o(e($),{"w-15":"",onClick:I},{default:v(()=>[...l[4]||(l[4]=[_("回复",-1)])]),_:1})])])):j("",!0),e(A)?(n(),s("div",Be,[o(S,null,{default:v(()=>[y("div",null,[o(U,{modelValue:e(g),"onUpdate:modelValue":l[1]||(l[1]=B=>J(g)?g.value=B:null),ref_key:"md",ref:D,"h-40px":"","m-y-3":"",onImgAdd:F},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:H},{default:v(()=>[...l[5]||(l[5]=[_("提交",-1)])]),_:1}),o(e($),{quaternary:"",onClick:T},{default:v(()=>[...l[6]||(l[6]=[_("取消",-1)])]),_:1})])):j("",!0),e(V)?j("",!0):(n(),s("div",Ne,[o(E,{otherreply:e(q)},null,8,["otherreply"])]))]))])}}};export{Ge as default};
