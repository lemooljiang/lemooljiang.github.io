import{_ as ae}from"./DFAhm5HZ.js";import{_ as E,p as H,b as L,g as ne,u as oe,f as se}from"./KPDNgkwZ.js";import{u as G}from"./Aq9Y9v8y.js";import{g as K,r as w,m as Q,c as s,o as n,b as y,i as x,j as g,a as o,t as N,u as e,d as v,B as $,n as J,F as P,e as W,f as re,h as X,w as Y,k as ie,p as ue}from"#entry";import{l as Z}from"./DHTvRraO.js";import"./BJ2ClxiI.js";const de={class:"item"},me={class:"child"},pe={class:"author"},ve={key:0},ye={key:0},fe={key:0},ce={id:"main"},ge={key:1},_e={key:1},ke={id:"main2"},he={key:2,class:"child"},ee={__name:"Allreplylist",props:{parentmsg:{type:Object}},setup(d){let{message:m}=K(["message"]);const f=G("user"),h=w(!1),c=w(!1),r=w(),b=w(),V=async(a,t)=>{let u=await upImage(a,t);b.value.$img2Url(a,u)},C=a=>{c.value=!0,a.children==0&&(a.child=[])},O=async(a,t,u)=>{c.value=!1;let A=f.value.wif,j=f.value.username,i=L(),I="",F=r.value,T={tags:["cn","cn-reader","miao"],dapp:"miao",format:"markdown"};if(F==""){m.error("文本不能为空！",{duration:5e3});return}let p={parent_author:a,parent_permlink:t,title:I,author:j,permlink:i,body:F,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(T)};u.child.push(p);let l={wif:A,parentAuthor:a,parentPermlink:t,author:j,permlink:i,title:I,body:F,jsonMetadata:T};const{data:k,pending:U,error:S}=await H("/hiveapi/posttohive",l);S.value?m.error(`回复失败！
`+S.value,{duration:5e3}):m.success("回复成功",{duration:5e3}),r.value=""},D=a=>{h.value=!0,r.value=a.body},_=async a=>{h.value=!1,a.body=r.value;let t=f.value.wif,u=f.value.username,A=a.parent_author,j=a.parent_permlink,i=a.permlink,I=a.title,F=r.value,M=a.json_metadata,T={wif:t,parentAuthor:A,parentPermlink:j,author:u,permlink:i,title:I,body:F,jsonMetadata:M};const{data:p,pending:l,error:k}=await H("/hiveapi/posttohive",T);k.value?m.error(`更新失败！
`+k.value,{duration:5e3}):m.success("更新成功",{duration:5e3}),r.value=""},q=()=>{c.value=!1,h.value=!1,r.value=""};return(a,t)=>{const u=Q("mavon-editor"),A=E,j=ee;return n(),s("div",de,[y("span",me,[y("span",pe,"@"+N(d.parentmsg.author),1),t[7]||(t[7]=g(" 　 ",-1)),o(u,{class:"replymd",modelValue:d.parentmsg.body,"onUpdate:modelValue":t[0]||(t[0]=i=>d.parentmsg.body=i),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"])]),e(f)?(n(),s("div",ve,[d.parentmsg.author==e(f).username?(n(),s("div",ye,[o(e($),{quaternary:"",onClick:t[1]||(t[1]=i=>D(d.parentmsg))},{default:v(()=>[...t[8]||(t[8]=[g("编辑",-1)])]),_:1}),e(h)?(n(),s("div",fe,[o(A,null,{default:v(()=>[y("div",ce,[o(u,{modelValue:e(r),"onUpdate:modelValue":t[2]||(t[2]=i=>J(r)?r.value=i:null),ref_key:"md",ref:b,"m-y-3":"",onImgAdd:V},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:t[3]||(t[3]=i=>_(d.parentmsg))},{default:v(()=>[...t[9]||(t[9]=[g("更新",-1)])]),_:1}),o(e($),{quaternary:"",onClick:q},{default:v(()=>[...t[10]||(t[10]=[g("取消",-1)])]),_:1})])):x("",!0)])):(n(),s("div",ge,[o(e($),{quaternary:"",onClick:t[4]||(t[4]=i=>C(d.parentmsg))},{default:v(()=>[...t[11]||(t[11]=[g("回复",-1)])]),_:1})]))])):x("",!0),e(c)?(n(),s("div",_e,[o(A,null,{default:v(()=>[y("div",ke,[o(u,{modelValue:e(r),"onUpdate:modelValue":t[5]||(t[5]=i=>J(r)?r.value=i:null),ref_key:"md",ref:b,"m-y-3":"",onImgAdd:V},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:t[6]||(t[6]=i=>O(d.parentmsg.author,d.parentmsg.permlink,d.parentmsg))},{default:v(()=>[...t[12]||(t[12]=[g("提交",-1)])]),_:1}),o(e($),{quaternary:"",onClick:q},{default:v(()=>[...t[13]||(t[13]=[g("取消",-1)])]),_:1})])):x("",!0),d.parentmsg.child?(n(),s("ul",he,[(n(!0),s(P,null,W(d.parentmsg.child,(i,I)=>(n(),re(j,{parentmsg:i,key:I},null,8,["parentmsg"]))),128))])):x("",!0)])}}},be={key:0},we=["src"],$e={key:1,class:"reply"},Ve={__name:"Allreplies",props:{otherreply:{type:Object,default:{}}},async setup(d){let m,f;const h=d,c=X(),r=c.params.author,b=c.params.permlink;let V={author:r,permlink:b};const{data:C,pending:O}=([m,f]=Y(()=>H("/hiveapi/getallreplies",V)),m=await m,f(),m);return ie(h,()=>{C.value.result.push(h.otherreply)}),(D,_)=>{const q=ee;return n(),s(P,null,[_[0]||(_[0]=y("h3",null,"留言",-1)),e(O)?(n(),s("div",be,[y("img",{src:e(Z),alt:"miao loading"},null,8,we)])):(n(),s("div",$e,[(n(!0),s(P,null,W(e(C).result,a=>(n(),s("div",null,[o(q,{parentmsg:a},null,8,["parentmsg"])]))),256))]))],64)}}},Ce={subContainer:""},je={key:0},xe={key:1},Oe={key:2},Ae={"text-size-2xl":"","text-center":"","m-t-10":""},Ie={"text-center":""},Se={key:0,"text-center":""},qe=["src"],Fe={key:1,flex:""},Te={key:0,"m-t-4":"","m-b-3":"","m-r-4":""},Ue={"m-t-4":"","m-b-3":""},Be={key:2},Ne={key:3},Le={__name:"[permlink]",async setup(d){let m,f,{message:h}=K(["message"]);const c=G("user"),r=X(),b=r.params.author,V=r.params.permlink;let C=w(!0);const O=w(!1),D=w(),_=w(),q=w(),a=w(),t=p=>{let l=/https:\/\/ipfs\.ilark\.io/g;return l!=null?p.replace(l,"https://yoyo.ilark.io/0x0/https://ipfs.ilark.io"):p},{data:u,pending:A,error:j}=([m,f]=Y(()=>ne("/hiveapi/miaos/@"+b+"/"+V)),m=await m,f(),m);u.value&&(C.value=!1,a.value=t(u.value.result.body)),oe({title:u?.value?.result.title});const i=()=>{ue({path:"/edit/"+V})},I=()=>{O.value=!0},F=async(p,l)=>{let k=await upImage(p,l);D.value.$img2Url(p,k)},M=async()=>{O.value=!1;let p=c.value.username,l=c.value.wif,k="",U=_.value,S=L(),B={tags:["cn","miao"],dapp:"miao",format:"markdown"},te={wif:l,parentAuthor:b,parentPermlink:V,author:p,permlink:S,title:k,body:U,jsonMetadata:B};const{data:De,pending:Me,error:z}=await H("/hiveapi/posttohive",te);z.value?h.error(`回复失败！
`+z.value,{duration:5e3}):h.success("回复成功",{duration:5e3});let le={parent_author:b,parent_permlink:V,title:k,author:p,permlink:S,body:U,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(B)};q.value=le,_.value=""},T=()=>{O.value=!1,_.value=""};return(p,l)=>{const k=ae,U=Q("mavon-editor"),S=E,R=Ve;return n(),s("div",Ce,[e(A)||e(C)?(n(),s("div",je,[o(k)])):e(j)?(n(),s("div",xe," 错误 "+N(e(j)),1)):(n(),s("div",Oe,[o(S,null,{default:v(()=>[y("div",Ae,N(e(u).result.title),1),y("p",Ie,"@"+N(e(u).result.author)+" 　"+N(("formatTime"in p?p.formatTime:e(se))(e(u).result.created)),1),o(U,{"p-t-3":"",modelValue:e(a),"onUpdate:modelValue":l[0]||(l[0]=B=>J(a)?a.value=B:null),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"]),l[2]||(l[2]=y("br",null,null,-1)),g(" 标签（tags）: "+N(e(u).result.tags.join("　")),1)]),_:1}),l[7]||(l[7]=y("br",null,null,-1)),e(C)?(n(),s("div",Se,[y("img",{src:e(Z),alt:"miao loading"},null,8,qe)])):x("",!0),e(c)?(n(),s("div",Fe,[e(c).username==e(b)?(n(),s("div",Te,[o(e($),{"w-15":"",onClick:i},{default:v(()=>[...l[3]||(l[3]=[g("编辑",-1)])]),_:1})])):x("",!0),y("div",Ue,[o(e($),{"w-15":"",onClick:I},{default:v(()=>[...l[4]||(l[4]=[g("回复",-1)])]),_:1})])])):x("",!0),e(O)?(n(),s("div",Be,[o(S,null,{default:v(()=>[y("div",null,[o(U,{modelValue:e(_),"onUpdate:modelValue":l[1]||(l[1]=B=>J(_)?_.value=B:null),ref_key:"md",ref:D,"h-40px":"","m-y-3":"",onImgAdd:F},null,8,["modelValue"])])]),_:1}),o(e($),{quaternary:"","m-r-2":"",onClick:M},{default:v(()=>[...l[5]||(l[5]=[g("提交",-1)])]),_:1}),o(e($),{quaternary:"",onClick:T},{default:v(()=>[...l[6]||(l[6]=[g("取消",-1)])]),_:1})])):x("",!0),e(C)?x("",!0):(n(),s("div",Ne,[o(R,{otherreply:e(q)},null,8,["otherreply"])]))]))])}}};export{Le as default};
