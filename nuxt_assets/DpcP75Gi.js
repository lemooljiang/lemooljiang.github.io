import{_ as te}from"./DFAhm5HZ.js";import{_ as R,p as D,b as z,g as le,u as ae,f as ne}from"./eMC-Jvvt.js";import{u as E}from"./Aq9Y9v8y.js";import{g as L,r as x,m as G,c as s,o as n,b as p,i as O,j as c,a as o,t as N,u as e,d as m,B as b,n as H,F as J,e as K,f as oe,h as Q,w as W,k as se,p as re}from"#entry";import{l as X}from"./DHTvRraO.js";import"./BJ2ClxiI.js";const ie={class:"item"},ue={class:"child"},de={class:"author"},me={key:0},pe={key:0},ye={key:0},ve={id:"main"},fe={key:1},ce={key:1},_e={id:"main2"},ge={key:2,class:"child"},Y={__name:"Allreplylist",props:{parentmsg:{type:Object}},setup(u){let{message:d}=L(["message"]);const y=E("user"),k=x(!1),v=x(!1),r=x(),h=x(),w=async(l,t)=>{let f=await upImage(l,t);h.value.$img2Url(l,f)},$=l=>{v.value=!0,l.children==0&&(l.child=[])},A=async(l,t,f)=>{v.value=!1;let S=y.value.wif,I=y.value.username,i=z(),q="",B=r.value,a={tags:["cn","cn-reader","miao"],dapp:"miao",format:"markdown"};if(B==""){d.error("文本不能为空！",{duration:5e3});return}let V={parent_author:l,parent_permlink:t,title:q,author:I,permlink:i,body:B,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(a)};f.child.push(V);let F={wif:S,parentAuthor:l,parentPermlink:t,author:I,permlink:i,title:q,body:B,jsonMetadata:a};const{data:C,pending:M,error:j}=await D("/hiveapi/posttohive",F);j.value?d.error(`回复失败！
`+j.value,{duration:5e3}):d.success("回复成功",{duration:5e3}),r.value=""},T=l=>{k.value=!0,r.value=l.body},_=async l=>{k.value=!1,l.body=r.value;let t=y.value.wif,f=y.value.username,S=l.parent_author,I=l.parent_permlink,i=l.permlink,q=l.title,B=r.value,g=l.json_metadata,a={wif:t,parentAuthor:S,parentPermlink:I,author:f,permlink:i,title:q,body:B,jsonMetadata:g};const{data:V,pending:F,error:C}=await D("/hiveapi/posttohive",a);C.value?d.error(`更新失败！
`+C.value,{duration:5e3}):d.success("更新成功",{duration:5e3}),r.value=""},U=()=>{v.value=!1,k.value=!1,r.value=""};return(l,t)=>{const f=G("mavon-editor"),S=R,I=Y;return n(),s("div",ie,[p("span",ue,[p("span",de,"@"+N(u.parentmsg.author),1),t[7]||(t[7]=c(" 　 ",-1)),o(f,{class:"replymd",modelValue:u.parentmsg.body,"onUpdate:modelValue":t[0]||(t[0]=i=>u.parentmsg.body=i),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"])]),e(y)?(n(),s("div",me,[u.parentmsg.author==e(y).username?(n(),s("div",pe,[o(e(b),{quaternary:"",onClick:t[1]||(t[1]=i=>T(u.parentmsg))},{default:m(()=>[...t[8]||(t[8]=[c("编辑",-1)])]),_:1}),e(k)?(n(),s("div",ye,[o(S,null,{default:m(()=>[p("div",ve,[o(f,{modelValue:e(r),"onUpdate:modelValue":t[2]||(t[2]=i=>H(r)?r.value=i:null),ref_key:"md",ref:h,"m-y-3":"",onImgAdd:w},null,8,["modelValue"])])]),_:1}),o(e(b),{quaternary:"","m-r-2":"",onClick:t[3]||(t[3]=i=>_(u.parentmsg))},{default:m(()=>[...t[9]||(t[9]=[c("更新",-1)])]),_:1}),o(e(b),{quaternary:"",onClick:U},{default:m(()=>[...t[10]||(t[10]=[c("取消",-1)])]),_:1})])):O("",!0)])):(n(),s("div",fe,[o(e(b),{quaternary:"",onClick:t[4]||(t[4]=i=>$(u.parentmsg))},{default:m(()=>[...t[11]||(t[11]=[c("回复",-1)])]),_:1})]))])):O("",!0),e(v)?(n(),s("div",ce,[o(S,null,{default:m(()=>[p("div",_e,[o(f,{modelValue:e(r),"onUpdate:modelValue":t[5]||(t[5]=i=>H(r)?r.value=i:null),ref_key:"md",ref:h,"m-y-3":"",onImgAdd:w},null,8,["modelValue"])])]),_:1}),o(e(b),{quaternary:"","m-r-2":"",onClick:t[6]||(t[6]=i=>A(u.parentmsg.author,u.parentmsg.permlink,u.parentmsg))},{default:m(()=>[...t[12]||(t[12]=[c("提交",-1)])]),_:1}),o(e(b),{quaternary:"",onClick:U},{default:m(()=>[...t[13]||(t[13]=[c("取消",-1)])]),_:1})])):O("",!0),u.parentmsg.child?(n(),s("ul",ge,[(n(!0),s(J,null,K(u.parentmsg.child,(i,q)=>(n(),oe(I,{parentmsg:i,key:q},null,8,["parentmsg"]))),128))])):O("",!0)])}}},ke={key:0},he=["src"],be={key:1,class:"reply"},we={__name:"Allreplies",props:{otherreply:{type:Object,default:{}}},async setup(u){let d,y;const k=u,v=Q(),r=v.params.author,h=v.params.permlink;let w={author:r,permlink:h};const{data:$,pending:A}=([d,y]=W(()=>D("/hiveapi/getallreplies",w)),d=await d,y(),d);return se(k,()=>{$.value.result.push(k.otherreply)}),(T,_)=>{const U=Y;return n(),s(J,null,[_[0]||(_[0]=p("h3",null,"留言",-1)),e(A)?(n(),s("div",ke,[p("img",{src:e(X),alt:"miao loading"},null,8,he)])):(n(),s("div",be,[(n(!0),s(J,null,K(e($).result,l=>(n(),s("div",null,[o(U,{parentmsg:l},null,8,["parentmsg"])]))),256))]))],64)}}},$e={subContainer:""},Ve={key:0},Ce={key:1},je={key:2},xe={"text-size-2xl":"","text-center":"","m-t-10":""},Oe={"text-center":""},Ae={key:0,"text-center":""},Se=["src"],Ie={key:1,flex:""},qe={key:0,"m-t-4":"","m-b-3":"","m-r-4":""},Fe={"m-t-4":"","m-b-3":""},Ue={key:2},Be={key:3},ze={__name:"[permlink]",async setup(u){let d,y,{message:k}=L(["message"]);const v=E("user"),r=Q(),h=r.params.author,w=r.params.permlink;let $=x(!0);const A=x(!1),T=x(),_=x(),U=x(),{data:l,pending:t,error:f}=([d,y]=W(()=>le("/hiveapi/miaos/@"+h+"/"+w)),d=await d,y(),d);l.value&&($.value=!1),ae({title:l?.value?.result.title});const S=()=>{re({path:"/edit/"+w})},I=()=>{A.value=!0},i=async(g,a)=>{let V=await upImage(g,a);T.value.$img2Url(g,V)},q=async()=>{A.value=!1;let g=v.value.username,a=v.value.wif,V="",F=_.value,C=z(),j={tags:["cn","miao"],dapp:"miao",format:"markdown"},Z={wif:a,parentAuthor:h,parentPermlink:w,author:g,permlink:C,title:V,body:F,jsonMetadata:j};const{data:Ne,pending:Te,error:P}=await D("/hiveapi/posttohive",Z);P.value?k.error(`回复失败！
`+P.value,{duration:5e3}):k.success("回复成功",{duration:5e3});let ee={parent_author:h,parent_permlink:w,title:V,author:g,permlink:C,body:F,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(j)};U.value=ee,_.value=""},B=()=>{A.value=!1,_.value=""};return(g,a)=>{const V=te,F=G("mavon-editor"),C=R,M=we;return n(),s("div",$e,[e(t)||e($)?(n(),s("div",Ve,[o(V)])):e(f)?(n(),s("div",Ce," 错误 "+N(e(f)),1)):(n(),s("div",je,[o(C,null,{default:m(()=>[p("div",xe,N(e(l).result.title),1),p("p",Oe,"@"+N(e(l).result.author)+" 　"+N(("formatTime"in g?g.formatTime:e(ne))(e(l).result.created)),1),o(F,{"p-t-3":"",modelValue:e(l).result.body,"onUpdate:modelValue":a[0]||(a[0]=j=>e(l).result.body=j),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"]),a[2]||(a[2]=p("br",null,null,-1)),c(" 标签（tags）: "+N(e(l).result.tags.join("　")),1)]),_:1}),a[7]||(a[7]=p("br",null,null,-1)),e($)?(n(),s("div",Ae,[p("img",{src:e(X),alt:"miao loading"},null,8,Se)])):O("",!0),e(v)?(n(),s("div",Ie,[e(v).username==e(h)?(n(),s("div",qe,[o(e(b),{"w-15":"",onClick:S},{default:m(()=>[...a[3]||(a[3]=[c("编辑",-1)])]),_:1})])):O("",!0),p("div",Fe,[o(e(b),{"w-15":"",onClick:I},{default:m(()=>[...a[4]||(a[4]=[c("回复",-1)])]),_:1})])])):O("",!0),e(A)?(n(),s("div",Ue,[o(C,null,{default:m(()=>[p("div",null,[o(F,{modelValue:e(_),"onUpdate:modelValue":a[1]||(a[1]=j=>H(_)?_.value=j:null),ref_key:"md",ref:T,"h-40px":"","m-y-3":"",onImgAdd:i},null,8,["modelValue"])])]),_:1}),o(e(b),{quaternary:"","m-r-2":"",onClick:q},{default:m(()=>[...a[5]||(a[5]=[c("提交",-1)])]),_:1}),o(e(b),{quaternary:"",onClick:B},{default:m(()=>[...a[6]||(a[6]=[c("取消",-1)])]),_:1})])):O("",!0),e($)?O("",!0):(n(),s("div",Be,[o(M,{otherreply:e(U)},null,8,["otherreply"])]))]))])}}};export{ze as default};
